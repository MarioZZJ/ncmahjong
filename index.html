<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å—æ˜Œéº»å°†è®°åˆ†å™¨</title>
  <meta name="theme-color" content="#c9a227">
  <link rel="manifest" href="manifest.json">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --primary: #c9a227;
      --primary-light: #e6c84d;
      --accent: #e74c3c;
      --bg: #0d1117;
      --card: #161b22;
      --card-border: #30363d;
      --text: #e6edf3;
      --text-light: #8b949e;
      --red: #f85149;
      --green: #3fb950;
      --gold: #ffd700;
      touch-action: manipulation;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 120px;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: #0d1117;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 { font-size: 22px; font-weight: 700; }
    
    .container { padding: 16px; max-width: 600px; margin: 0 auto; }
    
    .card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 12px;
    }
    
    .players-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    
    .player-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 12px;
    }
    
    .player-card.active { border-color: var(--primary); background: rgba(201,162,39,0.08); }
    
    .player-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .player-name .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      background: var(--primary);
      color: #0d1117;
      font-weight: 600;
    }
    
    .jing-input-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
    .jing-input-row:last-child { margin-bottom: 0; }
    .jing-label { font-size: 12px; color: var(--text-light); }
    .jing-controls { display: flex; align-items: center; gap: 6px; }
    
    .jing-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 1px solid var(--card-border);
      background: transparent;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .jing-btn:active { background: var(--primary); color: #0d1117; }
    .jing-val { width: 24px; text-align: center; font-size: 14px; font-weight: 600; color: var(--gold); }
    
    .zhuang-selector, .pao-selector { display: flex; gap: 8px; flex-wrap: wrap; }
    
    .zhuang-btn, .pao-btn {
      flex: 1;
      min-width: 70px;
      padding: 10px;
      border: 1px solid var(--card-border);
      border-radius: 8px;
      background: transparent;
      color: var(--text-light);
      font-size: 13px;
      cursor: pointer;
    }
    
    .zhuang-btn.active { border-color: var(--primary); background: rgba(201,162,39,0.15); color: var(--gold); }
    .pao-btn.active { border-color: var(--accent); background: rgba(248,81,73,0.15); color: var(--red); }
    
    .hu-types { display: flex; flex-wrap: wrap; gap: 8px; }
    
    .hu-btn {
      padding: 8px 14px;
      border: 1px solid var(--card-border);
      border-radius: 20px;
      background: transparent;
      color: var(--text-light);
      font-size: 13px;
      cursor: pointer;
    }
    
    .hu-btn.active { border-color: var(--primary); background: rgba(201,162,39,0.15); color: var(--gold); }
    
    .bangjin-hint {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--card-border);
    }
    
    .bangjin-hint.has-bangjin { color: var(--gold); }
    
    .result-card { background: linear-gradient(180deg, rgba(201,162,39,0.1) 0%, var(--card) 100%); border: 1px solid var(--primary); }
    
    .result-table { width: 100%; }
    .result-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--card-border); cursor: pointer; }
    .result-row:last-child { border-bottom: none; }
    .result-row.header { cursor: default; }
    .player-col { display: flex; align-items: center; gap: 6px; }
    
    .score-col { font-weight: 600; font-size: 16px; min-width: 60px; text-align: right; }
    .score-col.positive { color: var(--green); }
    .score-col.negative { color: var(--red); }
    .score-col.zhuang { color: var(--gold); }
    
    .player-detail {
      display: none;
      padding: 10px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-light);
    }
    
    .player-detail.show { display: block; }
    .player-detail .row { display: flex; justify-content: space-between; padding: 3px 0; }
    .player-detail .row span:last-child { color: var(--text); }
    
    .total-check {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--card-border);
      font-size: 13px;
      text-align: center;
      color: var(--text-light);
    }
    
    .total-check.valid { color: var(--green); }
    .total-check.invalid { color: var(--red); }
    
    .action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      padding: 12px 16px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      display: flex;
      gap: 10px;
      border-top: 1px solid var(--card-border);
    }
    
    .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; }
    .btn-reset { background: rgba(255,255,255,0.1); color: var(--text); }
    .btn-share { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: #0d1117; }
    
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: var(--card);
      color: var(--text);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      transition: transform 0.3s;
      z-index: 1000;
      border: 1px solid var(--primary);
    }
    
    .toast.show { transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <div class="header"><h1>ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†å™¨</h1></div>
  
  <div class="container">
    <div class="card">
      <div class="card-title">ğŸ´ å››å®¶ç²¾ç‰Œ</div>
      <div class="players-grid">
        <div class="player-card" data-player="dong">
          <div class="player-name"><span>ä¸œå®¶</span><span class="badge" id="dong-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="dong" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="dong-zheng">0</span><button class="jing-btn" data-player="dong" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="dong" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="dong-fu">0</span><button class="jing-btn" data-player="dong" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="nan">
          <div class="player-name"><span>å—å®¶</span><span class="badge" id="nan-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="nan" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="nan-zheng">0</span><button class="jing-btn" data-player="nan" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="nan" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="nan-fu">0</span><button class="jing-btn" data-player="nan" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="xi">
          <div class="player-name"><span>è¥¿å®¶</span><span class="badge" id="xi-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="xi" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="xi-zheng">0</span><button class="jing-btn" data-player="xi" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="xi" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="xi-fu">0</span><button class="jing-btn" data-player="xi" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="bei">
          <div class="player-name"><span>åŒ—å®¶</span><span class="badge" id="bei-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="bei" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="bei-zheng">0</span><button class="jing-btn" data-player="bei" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="bei" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="bei-fu">0</span><button class="jing-btn" data-player="bei" data-type="fu" data-dir="1">+</button></div></div>
        </div>
      </div>
      <div class="bangjin-hint" id="bangjin-hint">åªæœ‰ä¸€å®¶æœ‰ç²¾æ—¶è‡ªåŠ¨è§¦å‘éœ¸ç‹ç²¾</div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ‘‘ åº„å®¶</div>
      <div class="zhuang-selector">
        <button class="zhuang-btn" data-zhuang="dong">ä¸œå®¶</button>
        <button class="zhuang-btn active" data-zhuang="nan">å—å®¶</button>
        <button class="zhuang-btn" data-zhuang="xi">è¥¿å®¶</button>
        <button class="zhuang-btn" data-zhuang="bei">åŒ—å®¶</button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ’£ ç‚¹ç‚®ï¼ˆè‡ªæ‘¸åˆ™ä¸é€‰ï¼‰</div>
      <div class="pao-selector">
        <button class="pao-btn active" data-pao="none">è‡ªæ‘¸</button>
        <button class="pao-btn" data-pao="dong">ä¸œå®¶</button>
        <button class="pao-btn" data-pao="nan">å—å®¶</button>
        <button class="pao-btn" data-pao="xi">è¥¿å®¶</button>
        <button class="pao-btn" data-pao="bei">åŒ—å®¶</button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ€ èƒ¡ç‰Œç±»å‹ï¼ˆå¯å¤šé€‰ï¼‰</div>
      <div class="hu-types">
        <button class="hu-btn" data-type="pinghu">å¹³èƒ¡</button>
        <button class="hu-btn" data-type="zimo">è‡ªæ‘¸</button>
        <button class="hu-btn" data-type="qidui">å°ä¸ƒå¯¹</button>
        <button class="hu-btn" data-type="dqidui">å¤§ä¸ƒå¯¹</button>
        <button class="hu-btn" data-type="shisanlan">åä¸‰çƒ‚</button>
        <button class="hu-btn" data-type="qixing">ä¸ƒæ˜Ÿ</button>
        <button class="hu-btn" data-type="jingdiao">ç²¾é’“</button>
        <button class="hu-btn" data-type="gangshang">æ ä¸ŠèŠ±</button>
        <button class="hu-btn" data-type="gang">æš—æ </button>
        <button class="hu-btn" data-type="minggang">æ˜æ </button>
        <button class="hu-btn" data-type="tianhu">å¤©èƒ¡</button>
        <button class="hu-btn" data-type="dihu">åœ°èƒ¡</button>
        <button class="hu-btn" data-type="deguo">ğŸ‡©ğŸ‡ª å¾·å›½</button>
        <button class="hu-btn" data-type="gangjin">ğŸ’£ æ ç²¾</button>
      </div>
    </div>
    
    <div class="card result-card">
      <div class="card-title">ğŸ“Š ç»“ç®—ç»“æœï¼ˆç‚¹å‡»å±•å¼€æ˜ç»†ï¼‰</div>
      <div class="result-table">
        <div class="result-row header"><span>ç©å®¶</span><span style="text-align:right">è¿›å‡ºå­</span></div>
        
        <div class="result-row" data-player="dong">
          <div class="player-col"><span>ä¸œå®¶</span><span class="badge" id="res-dong-badge" style="display:none">åº„</span></div>
          <span class="score-col" id="res-dong">0</span>
        </div>
        <div class="player-detail" id="detail-dong"></div>
        
        <div class="result-row" data-player="nan">
          <div class="player-col"><span>å—å®¶</span><span class="badge" id="res-nan-badge" style="display:none">åº„</span></div>
          <span class="score-col" id="res-nan">0</span>
        </div>
        <div class="player-detail" id="detail-nan"></div>
        
        <div class="result-row" data-player="xi">
          <div class="player-col"><span>è¥¿å®¶</span><span class="badge" id="res-xi-badge" style="display:none">åº„</span></div>
          <span class="score-col" id="res-xi">0</span>
        </div>
        <div class="player-detail" id="detail-xi"></div>
        
        <div class="result-row" data-player="bei">
          <div class="player-col"><span>åŒ—å®¶</span><span class="badge" id="res-bei-badge" style="display:none">åº„</span></div>
          <span class="score-col" id="res-bei">0</span>
        </div>
        <div class="player-detail" id="detail-bei"></div>
      </div>
      
      <div class="total-check" id="total-check">æ€»è®¡: 0 âœ“</div>
    </div>
  </div>
  
  <div class="action-bar">
    <button class="btn btn-reset" id="btn-reset">é‡ç½®</button>
    <button class="btn btn-share" id="btn-share">å¤åˆ¶æˆ˜ç»©</button>
  </div>
  
  <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
  
  <script>
    const players = ['dong', 'nan', 'xi', 'bei'];
    const playerNames = { dong: 'ä¸œ', nan: 'å—', xi: 'è¥¿', bei: 'åŒ—' };
    
    let state = {
      zhuang: 'nan',
      pao: 'none',
      huTypes: new Set(),
      players: { dong: {zheng:0,fu:0}, nan: {zheng:0,fu:0}, xi: {zheng:0,fu:0}, bei: {zheng:0,fu:0} }
    };
    
    const chongguanTable = {5:2,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11};
    
    function calculate() {
      // 1. è®¡ç®—æ¯å®¶ç²¾ç‰ŒåŸºç¡€åˆ†
      const jingBase = {};
      let totalJing = 0;
      let playersWithJing = [];
      
      players.forEach(p => {
        jingBase[p] = state.players[p].zheng * 2 + state.players[p].fu;
        totalJing += jingBase[p];
        if (jingBase[p] > 0) playersWithJing.push(p);
      });
      
      // 2. éœ¸ç‹ç²¾åˆ¤æ–­ï¼ˆåªæœ‰ä¸€å®¶æœ‰ç²¾ï¼‰
      const isBangjin = playersWithJing.length === 1;
      const bangjinPlayer = isBangjin ? playersWithJing[0] : null;
      
      // æ›´æ–°éœ¸ç‹ç²¾æç¤º
      const hint = document.getElementById('bangjin-hint');
      if (isBangjin && bangjinPlayer) {
        hint.textContent = `ğŸ‘‘ éœ¸ç‹ç²¾ï¼š${playerNames[bangjinPlayer]}å®¶`;
        hint.classList.add('has-bangjin');
      } else {
        hint.textContent = 'åªæœ‰ä¸€å®¶æœ‰ç²¾æ—¶è‡ªåŠ¨è§¦å‘éœ¸ç‹ç²¾';
        hint.classList.remove('has-bangjin');
      }
      
      // 3. å†²å…³è®¡ç®—
      let chongguanMulti = totalJing >= 5 && chongguanTable[totalJing] ? chongguanTable[totalJing] : 1;
      
      // 4. è®¡ç®—æ¯å®¶ç²¾ç‰Œæœ€ç»ˆå¾—åˆ†
      const jingScores = {};
      let chongguanBonus = 0;
      
      players.forEach(p => {
        let s = jingBase[p];
        if (s > 0) {
          if (totalJing >= 5) s *= chongguanMulti; // å†²å…³
          if (p === bangjinPlayer) s *= 2; // éœ¸ç‹ç¿»å€
        }
        jingScores[p] = s;
      });
      
      if (totalJing >= 5) {
        chongguanBonus = (chongguanMulti - 1) * Object.values(jingBase).reduce((a,b)=>a+b,0);
      }
      
      // 5. èƒ¡ç‰Œåˆ†è®¡ç®—
      let baseScore = 0, huMulti = 1;
      let huPerson = state.zhuang;
      let isZimo = state.pao === 'none';
      if (!isZimo) huPerson = state.pao;
      
      // åˆ¤æ–­èƒ¡ç‰Œç±»å‹
      if (state.huTypes.has('tianhu') || state.huTypes.has('dihu')) {
        baseScore = 20;
        huMulti = 0; // å¤©èƒ¡åœ°èƒ¡ä¸å†ç¿»å€
      } else {
        if (state.huTypes.has('pinghu')) baseScore = 1;
        if (state.huTypes.has('zimo')) huMulti *= 2;
        if (state.huTypes.has('qidui') || state.huTypes.has('dqidui')) huMulti *= 2;
        if (state.huTypes.has('shisanlan')) huMulti *= 2;
        if (state.huTypes.has('qixing')) huMulti *= 4;
        if (state.huTypes.has('jingdiao')) huMulti *= 2;
        if (state.huTypes.has('gangshang')) huMulti *= 2;
        if (state.huTypes.has('deguo')) huMulti *= 2;
      }
      
      const huScore = baseScore * huMulti;
      
      // 6. ç»“ç®—æ¯å®¶
      const results = {};
      const details = {};
      
      // æ ç‰Œåˆ†ï¼ˆåªæœ‰æ ç²¾æœ‰åˆ†ï¼‰
      let gangjinScore = 0;
      if (state.huTypes.has('gangjin')) {
        gangjinScore = 30; // æ¯å®¶10å­ Ã— 3å®¶
      }
      
      // è®¡ç®—ç²¾ç‰Œæ€»åˆ†
      const totalJingScore = Object.values(jingScores).reduce((a,b)=>a+b,0);
      const jingPayPerPerson = totalJingScore / 3;
      
      players.forEach(p => {
        let score = 0;
        const detail = [];
        
        // ç²¾ç‰Œåˆ†ï¼šåº”æ”¶ - åº”ä»˜
        if (jingScores[p] > 0) {
          score += jingScores[p] - jingPayPerPerson;
          detail.push(`ç²¾ç‰Œ: +${jingScores[p]} - ${Math.round(jingPayPerPerson)}`);
        } else {
          score -= jingPayPerPerson;
          detail.push(`ç²¾ç‰Œ: -${Math.round(jingPayPerPerson)}`);
        }
        
        // æ ç²¾åˆ†
        if (state.huTypes.has('gangjin')) {
          if (p === huPerson) {
            score += gangjinScore;
            detail.push(`æ ç²¾: +${gangjinScore}`);
          } else {
            score -= 10;
            detail.push(`æ ç²¾: -10`);
          }
        }
        
        // èƒ¡ç‰Œåˆ†
        if (p === huPerson) {
          let hp = huScore;
          // åº„å®¶èƒ¡ Ã—2
          if (huPerson === state.zhuang) {
            hp *= 2;
          }
          
          if (isZimo) {
            // è‡ªæ‘¸ï¼šä¸‰å®¶å„ä»˜
            const fromEach = hp;
            score += fromEach * 3;
            detail.push(`è‡ªæ‘¸: +${fromEach}Ã—3`);
          } else {
            // ç‚¹ç‚®ï¼šç‚¹ç‚®è€…ä»˜Ã—2
            score += hp * 2;
            detail.push(`èƒ¡ç‰Œ: +${hp}Ã—2`);
          }
          
          // å¾·å›½é¢å¤–+5
          if (state.huTypes.has('deguo')) {
            score += 5;
            detail.push(`å¾·å›½: +5`);
          }
        } else if (p === state.pao && !isZimo) {
          // ç‚¹ç‚®è€…ä»˜é’±
          let hp = huScore;
          if (huPerson === state.zhuang) hp *= 2;
          score -= hp * 2;
          detail.push(`ç‚¹ç‚®: -${hp}Ã—2`);
        }
        
        // æ˜æ æš—æ ï¼ˆä¸äº§ç”Ÿåˆ†æ•°ï¼Œåªè®°å½•ï¼‰
        if (state.huTypes.has('gang')) {
          detail.push(`æš—æ : è®°å½•`);
        }
        if (state.huTypes.has('minggang')) {
          detail.push(`æ˜æ : è®°å½•`);
        }
        
        results[p] = score;
        details[p] = detail.length > 0 ? detail : ['æ— '];
      });
      
      updateResults(results, details, jingScores, chongguanBonus, gangjinScore, huScore);
    }
    
    function updateResults(results, details, jingScores, chongguan, gangjinScore, huScore) {
      let total = 0;
      
      players.forEach(p => {
        const s = results[p];
        total += s;
        
        const el = document.getElementById('res-' + p);
        el.textContent = (s >= 0 ? '+' : '') + s;
        el.className = 'score-col ' + (s > 0 ? 'positive' : s < 0 ? 'negative' : '') + (p === state.zhuang ? ' zhuang' : '');
        
        // æ˜ç»†
        const detailEl = document.getElementById('detail-' + p);
        detailEl.innerHTML = details[p].map(d => `<div class="row"><span></span><span>${d}</span></div>`).join('');
      });
      
      // åº„å®¶æ ‡è®°
      players.forEach(p => {
        document.getElementById(p + '-badge').style.display = (p === state.zhuang) ? 'inline' : 'none';
        document.getElementById('res-' + p + '-badge').style.display = (p === state.zhuang) ? 'inline' : 'none';
      });
      
      // æ€»è®¡æ£€æŸ¥
      const totalEl = document.getElementById('total-check');
      totalEl.textContent = `æ€»è®¡: ${total} ${total === 0 ? 'âœ“' : 'âœ—'}`;
      totalEl.className = 'total-check ' + (total === 0 ? 'valid' : 'invalid');
    }
    
    // ç²¾ç‰ŒæŒ‰é’®äº‹ä»¶
    document.querySelectorAll('.jing-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const p = btn.dataset.player, t = btn.dataset.type, d = parseInt(btn.dataset.dir);
        state.players[p][t] = Math.max(0, Math.min(4, state.players[p][t] + d));
        document.getElementById(p + '-' + t).textContent = state.players[p][t];
        calculate();
      });
    });
    
    // åº„å®¶é€‰æ‹©
    document.querySelectorAll('.zhuang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.zhuang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.zhuang = btn.dataset.zhuang;
        calculate();
      });
    });
    
    // ç‚¹ç‚®é€‰æ‹©
    document.querySelectorAll('.pao-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.pao-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.pao = btn.dataset.pao;
        calculate();
      });
    });
    
    // èƒ¡ç‰Œç±»å‹
    document.querySelectorAll('.hu-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const t = btn.dataset.type;
        state.huTypes.has(t) ? state.huTypes.delete(t) : state.huTypes.add(t);
        btn.classList.toggle('active');
        calculate();
      });
    });
    
    // ç‚¹å‡»å±•å¼€æ˜ç»†
    document.querySelectorAll('.result-row[data-player]').forEach(row => {
      row.addEventListener('click', () => {
        const p = row.dataset.player;
        document.getElementById('detail-' + p).classList.toggle('show');
      });
    });
    
    // é‡ç½®
    document.getElementById('btn-reset').addEventListener('click', () => {
      state = {
        zhuang: 'nan', pao: 'none', huTypes: new Set(),
        players: { dong: {zheng:0,fu:0}, nan: {zheng:0,fu:0}, xi: {zheng:0,fu:0}, bei: {zheng:0,fu:0} }
      };
      players.forEach(p => {
        document.getElementById(p + '-zheng').textContent = 0;
        document.getElementById(p + '-fu').textContent = 0;
      });
      document.querySelectorAll('.zhuang-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.zhuang-btn[data-zhuang="nan"]').classList.add('active');
      document.querySelectorAll('.pao-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.pao-btn[data-pao="none"]').classList.add('active');
      document.querySelectorAll('.hu-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.player-detail').forEach(d => d.classList.remove('show'));
      calculate();
    });
    
    // å¤åˆ¶æˆ˜ç»©
    document.getElementById('btn-share').addEventListener('click', async () => {
      const lines = ['ğŸ€„ å—æ˜Œéº»å°†ç»“ç®—', '----------------'];
      players.forEach(p => {
        const s = document.getElementById('res-' + p).textContent;
        const z = p === state.zhuang ? ' [åº„]' : '';
        lines.push(`${playerNames[p]}å®¶${z}: ${s}`);
      });
      lines.push('----------------');
      lines.push(`åº„å®¶: ${playerNames[state.zhuang]} | ${state.pao === 'none' ? 'è‡ªæ‘¸' : playerNames[state.pao] + 'ç‚¹ç‚®'}`);
      if (state.huTypes.size > 0) {
        lines.push(`ç‰Œå‹: ${Array.from(state.huTypes).join(', ')}`);
      }
      
      try {
        await navigator.clipboard.writeText(lines.join('\n'));
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      } catch(e) {}
    });
    
    calculate();
  </script>
</body>
</html>
