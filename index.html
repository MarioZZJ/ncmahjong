<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å—æ˜Œéº»å°†è®°åˆ†å™¨</title>
  <meta name="theme-color" content="#1a73e8">
  <link rel="manifest" href="manifest.json">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --primary: #1a73e8;
      --primary-dark: #1557b0;
      --accent: #ff6b6b;
      --bg: #f0f2f5;
      --card: #ffffff;
      --text: #333333;
      --text-light: #666666;
      --border: #e0e0e0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 100px;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, #4facfe 100%);
      color: white;
      padding: 24px 20px;
      text-align: center;
      border-radius: 0 0 24px 24px;
      box-shadow: 0 4px 20px rgba(26, 115, 232, 0.3);
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .container {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-title::before {
      content: "";
      width: 4px;
      height: 18px;
      background: var(--primary);
      border-radius: 2px;
    }
    
    /* ç©å®¶èº«ä»½é€‰æ‹© */
    .role-selector {
      display: flex;
      gap: 12px;
    }
    
    .role-btn {
      flex: 1;
      padding: 14px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: white;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .role-btn.active {
      border-color: var(--primary);
      background: rgba(26, 115, 232, 0.08);
      color: var(--primary);
    }
    
    /* èµ–å­é€‰æ‹© */
    .laizi-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
    }
    
    .laizi-label {
      font-size: 15px;
    }
    
    .laizi-count {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .laizi-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 2px solid var(--border);
      background: white;
      font-size: 20px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .laizi-btn:active {
      transform: scale(0.95);
    }
    
    .laizi-num {
      font-size: 22px;
      font-weight: 700;
      min-width: 30px;
      text-align: center;
      color: var(--primary);
    }
    
    /* ç‰Œå‹å¤šé€‰ */
    .hand-types {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .hand-type {
      padding: 12px 14px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .hand-type.active {
      border-color: var(--primary);
      background: rgba(26, 115, 232, 0.08);
    }
    
    .hand-type .name {
      font-weight: 500;
    }
    
    .hand-type .fan {
      font-size: 13px;
      color: var(--text-light);
    }
    
    .hand-type.active .fan {
      color: var(--primary);
      font-weight: 600;
    }
    
    /* ç»“æœæ˜¾ç¤º */
    .result-card {
      background: linear-gradient(135deg, var(--primary) 0%, #4facfe 100%);
      color: white;
      text-align: center;
      padding: 30px 20px;
    }
    
    .result-card .label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    
    .result-card .score {
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: 8px;
    }
    
    .result-card .detail {
      font-size: 14px;
      opacity: 0.85;
    }
    
    .result-card .detail span {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 20px;
      margin: 4px;
    }
    
    /* åº•éƒ¨åˆ†äº«æ  */
    .action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 16px 20px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
      box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
      display: flex;
      gap: 12px;
    }
    
    .btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-reset {
      background: var(--bg);
      color: var(--text);
    }
    
    .btn-share {
      background: var(--primary);
      color: white;
    }
    
    .btn:active {
      transform: scale(0.97);
    }
    
    /* å¼¹çª—æç¤º */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      transition: transform 0.3s;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
    
    @media (min-width: 500px) {
      .container {
        padding-top: 30px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†å™¨</h1>
    <p>è¾“å…¥ç‰Œå‹ï¼Œè‡ªåŠ¨è®¡ç®—ç•ªæ•°ä¸åˆ†æ•°</p>
  </div>
  
  <div class="container">
    <!-- ç©å®¶èº«ä»½ -->
    <div class="card">
      <div class="card-title">ç©å®¶èº«ä»½</div>
      <div class="role-selector">
        <button class="role-btn active" data-role="zhuang">ğŸ”¸ åº„å®¶</button>
        <button class="role-btn" data-role="xian">ğŸ”¹ é—²å®¶</button>
      </div>
    </div>
    
    <!-- èµ–å­æ•°é‡ -->
    <div class="card">
      <div class="card-title">èµ–å­æ•°é‡</div>
      <div class="laizi-row">
        <span class="laizi-label">ç¡¬èµ–å­ï¼ˆè´¢ç¥ï¼‰</span>
        <div class="laizi-count">
          <button class="laizi-btn" id="laizi-minus">âˆ’</button>
          <span class="laizi-num" id="laizi-num">0</span>
          <button class="laizi-btn" id="laizi-plus">+</button>
        </div>
      </div>
    </div>
    
    <!-- ç‰Œå‹é€‰æ‹© -->
    <div class="card">
      <div class="card-title">èƒ¡ç‰Œç‰Œå‹ï¼ˆå¯å¤šé€‰ï¼‰</div>
      <div class="hand-types">
        <div class="hand-type" data-type="pihu" data-fan="1">
          <span class="name">å±èƒ¡</span>
          <span class="fan">1ç•ª</span>
        </div>
        <div class="hand-type" data-type="menqianqing" data-fan="1">
          <span class="name">é—¨å‰æ¸…</span>
          <span class="fan">1ç•ª</span>
        </div>
        <div class="hand-type" data-type="pengpenghu" data-fan="2">
          <span class="name">ç¢°ç¢°èƒ¡</span>
          <span class="fan">2ç•ª</span>
        </div>
        <div class="hand-type" data-type="hunyise" data-fan="3">
          <span class="name">æ··ä¸€è‰²</span>
          <span class="fan">3ç•ª</span>
        </div>
        <div class="hand-type" data-type="qingyise" data-fan="4">
          <span class="name">æ¸…ä¸€è‰²</span>
          <span class="fan">4ç•ª</span>
        </div>
        <div class="hand-type" data-type="qidui" data-fan="3">
          <span class="name">ä¸ƒå¯¹</span>
          <span class="fan">3ç•ª</span>
        </div>
        <div class="hand-type" data-type="haohuaqidui" data-fan="4">
          <span class="name">è±ªåä¸ƒå¯¹</span>
          <span class="fan">4ç•ª</span>
        </div>
        <div class="hand-type" data-type="hailao" data-fan="2">
          <span class="name">æµ·åº•ææœˆ</span>
          <span class="fan">2ç•ª</span>
        </div>
        <div class="hand-type" data-type="gangshanghua" data-fan="2">
          <span class="name">æ ä¸Šå¼€èŠ±</span>
          <span class="fan">2ç•ª</span>
        </div>
        <div class="hand-type" data-type="qiangganghu" data-fan="2">
          <span class="name">æŠ¢æ èƒ¡</span>
          <span class="fan">2ç•ª</span>
        </div>
        <div class="hand-type" data-type="quanqiuren" data-fan="2">
          <span class="name">å…¨æ±‚äºº</span>
          <span class="fan">2ç•ª</span>
        </div>
      </div>
    </div>
    
    <!-- è®¡ç®—ç»“æœ -->
    <div class="card result-card">
      <div class="label">å½“å‰å¾—åˆ†</div>
      <div class="score" id="result-score">2</div>
      <div class="detail" id="result-detail">
        <span>1ç•ª</span>
      </div>
    </div>
  </div>
  
  <!-- åº•éƒ¨æ“ä½œæ  -->
  <div class="action-bar">
    <button class="btn btn-reset" id="btn-reset">é‡ç½®</button>
    <button class="btn btn-share" id="btn-share">å¤åˆ¶æˆ˜ç»©</button>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
  
  <script>
    // çŠ¶æ€
    let state = {
      role: 'zhuang',  // zhuang | xian
      laizi: 0,
      handTypes: new Set(['pihu'])  // å±èƒ¡é»˜è®¤é€‰ä¸­
    };
    
    // ç‰Œå‹å®šä¹‰
    const handTypeData = {
      pihu: { name: 'å±èƒ¡', fan: 1 },
      menqianqing: { name: 'é—¨å‰æ¸…', fan: 1 },
      pengpenghu: { name: 'ç¢°ç¢°èƒ¡', fan: 2 },
      hunyise: { name: 'æ··ä¸€è‰²', fan: 3 },
      qingyise: { name: 'æ¸…ä¸€è‰²', fan: 4 },
      qidui: { name: 'ä¸ƒå¯¹', fan: 3 },
      haohuaqidui: { name: 'è±ªåä¸ƒå¯¹', fan: 4 },
      hailao: { name: 'æµ·åº•ææœˆ', fan: 2 },
      gangshanghua: { name: 'æ ä¸Šå¼€èŠ±', fan: 2 },
      qiangganghu: { name: 'æŠ¢æ èƒ¡', fan: 2 },
      quanqiuren: { name: 'å…¨æ±‚äºº', fan: 2 }
    };
    
    // DOM å…ƒç´ 
    const laiziNum = document.getElementById('laizi-num');
    const laiziMinus = document.getElementById('laizi-minus');
    const laiziPlus = document.getElementById('laizi-plus');
    const resultScore = document.getElementById('result-score');
    const resultDetail = document.getElementById('result-detail');
    const toast = document.getElementById('toast');
    
    // è®¡ç®—åˆ†æ•°
    function calculate() {
      // è®¡ç®—æ€»ç•ªæ•°
      let totalFan = 0;
      const selectedTypes = [];
      
      state.handTypes.forEach(type => {
        totalFan += handTypeData[type].fan;
        selectedTypes.push(handTypeData[type].name);
      });
      
      // èµ–å­ç•ªæ•°
      totalFan += state.laizi;
      
      // åº„å®¶ç•ªæ•°
      if (state.role === 'zhuang') {
        totalFan += 1;
        selectedTypes.push('åº„å®¶');
      }
      
      // è®¡ç®—åˆ†æ•°ï¼š2^(ç•ªæ•°-1)ï¼Œæœ€ä½1ç•ª=1åˆ†
      const baseScore = totalFan >= 1 ? Math.pow(2, totalFan - 1) : 1;
      
      // åº„å®¶èƒ¡ç‰ŒÃ—2
      const finalScore = state.role === 'zhuang' ? baseScore * 2 : baseScore;
      
      // æ›´æ–°UI
      resultScore.textContent = finalScore;
      
      // æ„å»ºè¯¦æƒ…
      const detailParts = [];
      if (totalFan > 0) {
        detailParts.push(`${totalFan}ç•ª`);
      }
      if (state.laizi > 0) {
        detailParts.push(`${state.laizi}èµ–`);
      }
      if (state.role === 'zhuang') {
        detailParts.push('åº„å®¶');
      }
      resultDetail.innerHTML = detailParts.length > 0 
        ? detailParts.map(d => `<span>${d}</span>`).join('')
        : '<span>0ç•ª</span>';
    }
    
    // è§’è‰²é€‰æ‹©
    document.querySelectorAll('.role-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.role = btn.dataset.role;
        calculate();
      });
    });
    
    // èµ–å­æŒ‰é’®
    laiziMinus.addEventListener('click', () => {
      if (state.laizi > 0) {
        state.laizi--;
        laiziNum.textContent = state.laizi;
        calculate();
      }
    });
    
    laiziPlus.addEventListener('click', () => {
      if (state.laizi < 4) {
        state.laizi++;
        laiziNum.textContent = state.laizi;
        calculate();
      }
    });
    
    // ç‰Œå‹é€‰æ‹©
    document.querySelectorAll('.hand-type').forEach(el => {
      el.addEventListener('click', () => {
        const type = el.dataset.type;
        
        // å±èƒ¡ä¸èƒ½å–æ¶ˆ
        if (type === 'pihu') return;
        
        if (state.handTypes.has(type)) {
          state.handTypes.delete(type);
          el.classList.remove('active');
        } else {
          state.handTypes.add(type);
          el.classList.add('active');
        }
        calculate();
      });
    });
    
    // é‡ç½®
    document.getElementById('btn-reset').addEventListener('click', () => {
      state.laizi = 0;
      state.handTypes = new Set(['pihu']);
      state.role = 'zhuang';
      
      laiziNum.textContent = 0;
      document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.role-btn[data-role="zhuang"]').classList.add('active');
      document.querySelectorAll('.hand-type').forEach(el => {
        el.classList.toggle('active', el.dataset.type === 'pihu');
      });
      
      calculate();
    });
    
    // å¤åˆ¶æˆ˜ç»©
    document.getElementById('btn-share').addEventListener('click', async () => {
      const score = resultScore.textContent;
      const detail = Array.from(document.querySelectorAll('#result-detail span')).map(s => s.textContent).join(' ');
      const text = `ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†\nå¾—åˆ†ï¼š${score}åˆ†\n${detail}`;
      
      try {
        await navigator.clipboard.writeText(text);
        showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch (err) {
        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    });
    
    // æ˜¾ç¤ºToast
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }
    
    // åˆå§‹åŒ–
    calculate();
  </script>
</body>
</html>
