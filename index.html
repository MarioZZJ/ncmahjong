<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å—æ˜Œéº»å°†è®°åˆ†å™¨</title>
  <meta name="theme-color" content="#c9a227">
  <link rel="manifest" href="manifest.json">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --primary: #c9a227;
      --primary-light: #e6c84d;
      --accent: #e74c3c;
      --bg: #0d1117;
      --card: #161b22;
      --card-border: #30363d;
      --text: #e6edf3;
      --text-light: #8b949e;
      --red: #f85149;
      --green: #3fb950;
      --gold: #ffd700;
      touch-action: manipulation;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 120px;
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: #0d1117;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 { font-size: 22px; font-weight: 700; }
    
    .container { padding: 16px; max-width: 600px; margin: 0 auto; }
    
    .card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 12px;
    }
    
    .players-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    
    .player-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 12px;
    }
    
    .player-card.active { border-color: var(--primary); background: rgba(201,162,39,0.08); }
    
    .player-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .player-name .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      background: var(--primary);
      color: #0d1117;
      font-weight: 600;
    }
    
    .jing-input-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
    .jing-input-row:last-child { margin-bottom: 0; }
    .jing-label { font-size: 12px; color: var(--text-light); }
    .jing-controls { display: flex; align-items: center; gap: 6px; }
    
    .jing-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 1px solid var(--card-border);
      background: transparent;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .jing-btn:active { background: var(--primary); color: #0d1117; }
    .jing-val { width: 24px; text-align: center; font-size: 14px; font-weight: 600; color: var(--gold); }
    
    .zhuang-selector, .pao-selector { display: flex; gap: 8px; flex-wrap: wrap; }
    
    .zhuang-btn, .pao-btn {
      flex: 1;
      min-width: 70px;
      padding: 10px;
      border: 1px solid var(--card-border);
      border-radius: 8px;
      background: transparent;
      color: var(--text-light);
      font-size: 13px;
      cursor: pointer;
    }
    
    .zhuang-btn.active { border-color: var(--primary); background: rgba(201,162,39,0.15); color: var(--gold); }
    .pao-btn.active { border-color: var(--accent); background: rgba(248,81,73,0.15); color: var(--red); }
    
    .hu-types, .special-options { display: flex; flex-wrap: wrap; gap: 8px; }
    
    .hu-btn, .special-btn {
      padding: 8px 14px;
      border: 1px solid var(--card-border);
      border-radius: 20px;
      background: transparent;
      color: var(--text-light);
      font-size: 13px;
      cursor: pointer;
    }
    
    .hu-btn.active { border-color: var(--primary); background: rgba(201,162,39,0.15); color: var(--gold); }
    .special-btn.active { border-color: var(--accent); background: rgba(248,81,73,0.15); color: var(--red); }
    
    .bangjin-check {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--card-border);
    }
    
    .bangjin-check input { width: 16px; height: 16px; accent-color: var(--gold); }
    .bangjin-check label { font-size: 13px; color: var(--text-light); }
    
    .result-card { background: linear-gradient(180deg, rgba(201,162,39,0.1) 0%, var(--card) 100%); border: 1px solid var(--primary); }
    
    .result-table { width: 100%; }
    .result-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--card-border); }
    .result-row:last-child { border-bottom: none; }
    .result-row.header { font-size: 12px; color: var(--text-light); padding-bottom: 8px; }
    .player-col { display: flex; align-items: center; gap: 6px; }
    
    .score-col { font-weight: 600; font-size: 16px; min-width: 60px; text-align: right; }
    .score-col.positive { color: var(--green); }
    .score-col.negative { color: var(--red); }
    .score-col.zhuang { color: var(--gold); }
    
    .detail-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--card-border); }
    .detail-title { font-size: 12px; color: var(--text-light); margin-bottom: 8px; }
    .detail-row { display: flex; justify-content: space-between; font-size: 13px; color: var(--text-light); padding: 4px 0; }
    .detail-row span:last-child { color: var(--text); }
    
    .action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      padding: 12px 16px;
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      display: flex;
      gap: 10px;
      border-top: 1px solid var(--card-border);
    }
    
    .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; }
    .btn-reset { background: rgba(255,255,255,0.1); color: var(--text); }
    .btn-share { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: #0d1117; }
    
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: var(--card);
      color: var(--text);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      transition: transform 0.3s;
      z-index: 1000;
      border: 1px solid var(--primary);
    }
    
    .toast.show { transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <div class="header"><h1>ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†å™¨</h1></div>
  
  <div class="container">
    <div class="card">
      <div class="card-title">ğŸ´ å››å®¶ç²¾ç‰Œ</div>
      <div class="players-grid">
        <div class="player-card" data-player="dong">
          <div class="player-name"><span>ä¸œå®¶</span><span class="badge" id="dong-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="dong" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="dong-zheng">0</span><button class="jing-btn" data-player="dong" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="dong" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="dong-fu">0</span><button class="jing-btn" data-player="dong" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="nan">
          <div class="player-name"><span>å—å®¶</span><span class="badge" id="nan-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="nan" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="nan-zheng">0</span><button class="jing-btn" data-player="nan" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="nan" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="nan-fu">0</span><button class="jing-btn" data-player="nan" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="xi">
          <div class="player-name"><span>è¥¿å®¶</span><span class="badge" id="xi-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="xi" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="xi-zheng">0</span><button class="jing-btn" data-player="xi" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="xi" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="xi-fu">0</span><button class="jing-btn" data-player="xi" data-type="fu" data-dir="1">+</button></div></div>
        </div>
        <div class="player-card" data-player="bei">
          <div class="player-name"><span>åŒ—å®¶</span><span class="badge" id="bei-badge" style="display:none">åº„</span></div>
          <div class="jing-input-row"><span class="jing-label">æ­£ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="bei" data-type="zheng" data-dir="-1">âˆ’</button><span class="jing-val" id="bei-zheng">0</span><button class="jing-btn" data-player="bei" data-type="zheng" data-dir="1">+</button></div></div>
          <div class="jing-input-row"><span class="jing-label">å‰¯ç²¾</span><div class="jing-controls"><button class="jing-btn" data-player="bei" data-type="fu" data-dir="-1">âˆ’</button><span class="jing-val" id="bei-fu">0</span><button class="jing-btn" data-player="bei" data-type="fu" data-dir="1">+</button></div></div>
        </div>
      </div>
      <div class="bangjin-check">
        <input type="checkbox" id="bangjin">
        <label for="bangjin">éœ¸ç‹ç²¾ï¼ˆåªæœ‰ä¸€å®¶æœ‰ç²¾ï¼‰</label>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ‘‘ åº„å®¶</div>
      <div class="zhuang-selector">
        <button class="zhuang-btn" data-zhuang="dong">ä¸œå®¶</button>
        <button class="zhuang-btn active" data-zhuang="nan">å—å®¶</button>
        <button class="zhuang-btn" data-zhuang="xi">è¥¿å®¶</button>
        <button class="zhuang-btn" data-zhuang="bei">åŒ—å®¶</button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ’£ ç‚¹ç‚®ï¼ˆè‡ªæ‘¸åˆ™ä¸é€‰ï¼‰</div>
      <div class="pao-selector">
        <button class="pao-btn active" data-pao="none">è‡ªæ‘¸</button>
        <button class="pao-btn" data-pao="dong">ä¸œå®¶</button>
        <button class="pao-btn" data-pao="nan">å—å®¶</button>
        <button class="pao-btn" data-pao="xi">è¥¿å®¶</button>
        <button class="pao-btn" data-pao="bei">åŒ—å®¶</button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ€ èƒ¡ç‰Œç±»å‹ï¼ˆå¯å¤šé€‰ï¼‰</div>
      <div class="hu-types">
        <button class="hu-btn" data-type="pinghu">å¹³èƒ¡</button>
        <button class="hu-btn" data-type="zimo">è‡ªæ‘¸</button>
        <button class="hu-btn" data-type="qidui">å°ä¸ƒå¯¹</button>
        <button class="hu-btn" data-type="dqidui">å¤§ä¸ƒå¯¹</button>
        <button class="hu-btn" data-type="shisanlan">åä¸‰çƒ‚</button>
        <button class="hu-btn" data-type="qixing">ä¸ƒæ˜Ÿ</button>
        <button class="hu-btn" data-type="jingdiao">ç²¾é’“</button>
        <button class="hu-btn" data-type="gangshang">æ ä¸ŠèŠ±</button>
        <button class="hu-btn" data-type="tianhu">å¤©èƒ¡</button>
        <button class="hu-btn" data-type="dihu">åœ°èƒ¡</button>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">âš¡ ç‰¹æ®ŠçŠ¶æ€</div>
      <div class="special-options">
        <button class="special-btn" data-special="deguo">ğŸ‡©ğŸ‡ª å¾·å›½</button>
        <button class="special-btn" data-special="dezhongde">ğŸ‡©ğŸ‡ªğŸ‡©ğŸ‡ª å¾·ä¸­å¾·</button>
        <button class="special-btn" data-special="gang">ğŸšª æš—æ </button>
        <button class="special-btn" data-special="minggang">ğŸšª æ˜æ </button>
        <button class="special-btn" data-special="gangjin">ğŸ’£ æ ç²¾</button>
      </div>
    </div>
    
    <div class="card result-card">
      <div class="card-title">ğŸ“Š ç»“ç®—ç»“æœ</div>
      <div class="result-table">
        <div class="result-row header"><span>ç©å®¶</span><span style="text-align:right">è¿›å‡ºå­</span></div>
        <div class="result-row"><div class="player-col"><span>ä¸œå®¶</span><span class="badge" id="res-dong-badge" style="display:none">åº„</span></div><span class="score-col" id="res-dong">0</span></div>
        <div class="result-row"><div class="player-col"><span>å—å®¶</span><span class="badge" id="res-nan-badge" style="display:none">åº„</span></div><span class="score-col" id="res-nan">0</span></div>
        <div class="result-row"><div class="player-col"><span>è¥¿å®¶</span><span class="badge" id="res-xi-badge" style="display:none">åº„</span></div><span class="score-col" id="res-xi">0</span></div>
        <div class="result-row"><div class="player-col"><span>åŒ—å®¶</span><span class="badge" id="res-bei-badge" style="display:none">åº„</span></div><span class="score-col" id="res-bei">0</span></div>
      </div>
      <div class="detail-section">
        <div class="detail-title">æ˜ç»†</div>
        <div class="detail-row"><span>ç²¾ç‰Œåˆ†</span><span id="detail-jing">0</span></div>
        <div class="detail-row"><span>å†²å…³/éœ¸ç‹</span><span id="detail-chongguan">0</span></div>
        <div class="detail-row"><span>æ ç‰Œåˆ†</span><span id="detail-gang">0</span></div>
        <div class="detail-row"><span>èƒ¡ç‰Œåˆ†</span><span id="detail-hu">0</span></div>
      </div>
    </div>
  </div>
  
  <div class="action-bar">
    <button class="btn btn-reset" id="btn-reset">é‡ç½®</button>
    <button class="btn btn-share" id="btn-share">å¤åˆ¶æˆ˜ç»©</button>
  </div>
  
  <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
  
  <script>
    const players = ['dong', 'nan', 'xi', 'bei'];
    
    let state = {
      zhuang: 'nan',
      pao: 'none',
      huTypes: new Set(),
      specials: new Set(),
      bangjin: false,
      players: { dong: {zheng:0,fu:0}, nan: {zheng:0,fu:0}, xi: {zheng:0,fu:0}, bei: {zheng:0,fu:0} }
    };
    
    const chongguanTable = {5:2,6:3,7:4,8:5,9:6,10:7,11:8,12:9,13:10,14:11};
    
    function calculate() {
      const jingScores = {};
      let totalJing = 0;
      
      players.forEach(p => {
        jingScores[p] = state.players[p].zheng * 2 + state.players[p].fu;
        totalJing += jingScores[p];
      });
      
      let chongguanMulti = totalJing >= 5 && chongguanTable[totalJing] ? chongguanTable[totalJing] : 1;
      let bangjinPlayer = null;
      
      if (state.bangjin) {
        for (const p of players) {
          if (jingScores[p] > 0) {
            bangjinPlayer = bangjinPlayer === null ? p : null;
            if (!bangjinPlayer) break;
          }
        }
      }
      
      const finalJingScores = {};
      players.forEach(p => {
        let s = jingScores[p];
        if (s > 0) {
          s *= chongguanMulti;
          if (state.bangjin && bangjinPlayer === p) s *= 2;
        }
        finalJingScores[p] = s;
      });
      
      let chongguanBonus = (chongguanMulti - 1) * Object.values(jingScores).reduce((a,b)=>a+b,0);
      if (state.bangjin && bangjinPlayer) chongguanBonus += finalJingScores[bangjinPlayer];
      
      let gangScore = 0;
      if (state.specials.has('gang')) gangScore += 6;
      if (state.specials.has('minggang')) gangScore += 3;
      if (state.specials.has('gangjin')) gangScore += 30;
      
      let baseScore = 0, huMulti = 1;
      let huPerson = state.zhuang;
      let isZimo = state.pao === 'none';
      if (!isZimo) huPerson = state.pao;
      
      if (state.huTypes.has('tianhu') || state.huTypes.has('dihu')) {
        baseScore = 20;
        huMulti = 0;
      } else {
        if (state.huTypes.has('pinghu')) baseScore = 1;
        if (state.huTypes.has('zimo')) huMulti *= 2;
        if (state.huTypes.has('qidui') || state.huTypes.has('dqidui')) huMulti *= 2;
        if (state.huTypes.has('shisanlan')) huMulti *= 2;
        if (state.huTypes.has('qixing')) huMulti *= 4;
        if (state.huTypes.has('jingdiao')) huMulti *= 2;
        if (state.huTypes.has('gangshang')) huMulti *= 2;
        if (state.specials.has('dezhongde')) huMulti *= 4;
        else if (state.specials.has('deguo')) huMulti *= 2;
      }
      
      const huScore = baseScore * huMulti;
      const results = {};
      
      players.forEach(p => {
        let score = 0;
        score += finalJingScores[p];
        score += gangScore;
        
        if (p === huPerson) {
          let hp = huScore;
          if (huPerson === state.zhuang) hp *= 2;
          if (isZimo) score += hp * 3;
          else score += hp * 2;
          if (state.specials.has('deguo') || state.specials.has('dezhongde')) score += 5;
        } else if (p === state.pao && !isZimo) {
          let hp = huScore;
          if (huPerson === state.zhuang) hp *= 2;
          score -= hp * 2;
        }
        
        results[p] = score;
      });
      
      updateResults(results, finalJingScores, chongguanBonus, gangScore, huScore);
    }
    
    function updateResults(results, jingScores, chongguan, gangScore, huScore) {
      players.forEach(p => {
        const el = document.getElementById('res-' + p);
        const s = results[p];
        el.textContent = (s >= 0 ? '+' : '') + s;
        el.className = 'score-col ' + (s > 0 ? 'positive' : s < 0 ? 'negative' : '') + (p === state.zhuang ? ' zhuang' : '');
      });
      
      players.forEach(p => {
        document.getElementById(p + '-badge').style.display = (p === state.zhuang) ? 'inline' : 'none';
        document.getElementById('res-' + p + '-badge').style.display = (p === state.zhuang) ? 'inline' : 'none';
      });
      
      document.getElementById('detail-jing').textContent = Object.values(jingScores).reduce((a,b)=>a+b,0);
      document.getElementById('detail-chongguan').textContent = chongguan;
      document.getElementById('detail-gang').textContent = gangScore;
      document.getElementById('detail-hu').textContent = huScore;
    }
    
    document.querySelectorAll('.jing-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const p = btn.dataset.player, t = btn.dataset.type, d = parseInt(btn.dataset.dir);
        state.players[p][t] = Math.max(0, Math.min(4, state.players[p][t] + d));
        document.getElementById(p + '-' + t).textContent = state.players[p][t];
        calculate();
      });
    });
    
    document.querySelectorAll('.zhuang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.zhuang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.zhuang = btn.dataset.zhuang;
        calculate();
      });
    });
    
    document.querySelectorAll('.pao-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.pao-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.pao = btn.dataset.pao;
        calculate();
      });
    });
    
    document.querySelectorAll('.hu-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const t = btn.dataset.type;
        state.huTypes.has(t) ? state.huTypes.delete(t) : state.huTypes.add(t);
        btn.classList.toggle('active');
        calculate();
      });
    });
    
    document.querySelectorAll('.special-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const s = btn.dataset.special;
        state.specials.has(s) ? state.specials.delete(s) : state.specials.add(s);
        btn.classList.toggle('active');
        calculate();
      });
    });
    
    document.getElementById('bangjin').addEventListener('change', e => {
      state.bangjin = e.target.checked;
      calculate();
    });
    
    document.getElementById('btn-reset').addEventListener('click', () => {
      state = {
        zhuang: 'nan', pao: 'none', huTypes: new Set(), specials: new Set(), bangjin: false,
        players: { dong: {zheng:0,fu:0}, nan: {zheng:0,fu:0}, xi: {zheng:0,fu:0}, bei: {zheng:0,fu:0} }
      };
      players.forEach(p => {
        document.getElementById(p + '-zheng').textContent = 0;
        document.getElementById(p + '-fu').textContent = 0;
      });
      document.querySelectorAll('.zhuang-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.zhuang-btn[data-zhuang="nan"]').classList.add('active');
      document.querySelectorAll('.pao-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.pao-btn[data-pao="none"]').classList.add('active');
      document.querySelectorAll('.hu-btn, .special-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('bangjin').checked = false;
      calculate();
    });
    
    document.getElementById('btn-share').addEventListener('click', async () => {
      const lines = ['ğŸ€„ å—æ˜Œéº»å°†ç»“ç®—', '----------------'];
      players.forEach(p => {
        const s = document.getElementById('res-' + p).textContent;
        const z = p === state.zhuang ? ' [åº„]' : '';
        lines.push(`${p === 'dong' ? 'ä¸œ' : p === 'nan' ? 'å—' : p === 'xi' ? 'è¥¿' : 'åŒ—'}å®¶${z}: ${s}`);
      });
      lines.push('----------------');
      lines.push(`ç²¾:${document.getElementById('detail-jing').textContent} å†²å…³:${document.getElementById('detail-chongguan').textContent} æ :${document.getElementById('detail-gang').textContent} èƒ¡:${document.getElementById('detail-hu').textContent}`);
      
      try {
        await navigator.clipboard.writeText(lines.join('\n'));
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      } catch(e) {}
    });
    
    calculate();
  </script>
</body>
</html>
