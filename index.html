<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å—æ˜Œéº»å°†è®°åˆ†å™¨</title>
  <meta name="theme-color" content="#1a73e8">
  <link rel="manifest" href="manifest.json">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --primary: #c9a227;
      --primary-dark: #a68520;
      --accent: #e74c3c;
      --bg: #1a1a2e;
      --card: #16213e;
      --card-light: #1f3460;
      --text: #eee;
      --text-light: #aaa;
      --gold: #ffd700;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 110px;
      background-image: 
        radial-gradient(ellipse at top, #1f3460 0%, transparent 50%),
        radial-gradient(ellipse at bottom, #0f0f23 0%, transparent 50%);
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, #e6b800 100%);
      color: #1a1a2e;
      padding: 24px 20px;
      text-align: center;
      border-radius: 0 0 24px 24px;
      box-shadow: 0 4px 30px rgba(201, 162, 39, 0.4);
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .header p {
      font-size: 14px;
      opacity: 0.85;
    }
    
    .container {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--gold);
    }
    
    .card-title::before {
      content: "â™¦";
      font-size: 12px;
    }
    
    /* ç²¾ç‰Œè¾“å…¥ */
    .jing-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .jing-row:last-child {
      border-bottom: none;
    }
    
    .jing-label {
      font-size: 14px;
    }
    
    .jing-count {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .jing-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--primary);
      background: transparent;
      color: var(--primary);
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .jing-btn:active {
      transform: scale(0.9);
      background: var(--primary);
      color: var(--bg);
    }
    
    .jing-num {
      font-size: 20px;
      font-weight: 700;
      min-width: 28px;
      text-align: center;
      color: var(--gold);
    }
    
    .jing-sub {
      font-size: 12px;
      color: var(--text-light);
      min-width: 50px;
      text-align: right;
    }
    
    /* ç©å®¶èº«ä»½ */
    .role-selector {
      display: flex;
      gap: 10px;
    }
    
    .role-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      background: transparent;
      color: var(--text);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .role-btn.active {
      border-color: var(--primary);
      background: rgba(201, 162, 39, 0.15);
      color: var(--gold);
    }
    
    /* ç‰Œå‹å¤šé€‰ */
    .hand-types {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .hand-type {
      padding: 10px 12px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      background: transparent;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .hand-type.active {
      border-color: var(--primary);
      background: rgba(201, 162, 39, 0.15);
    }
    
    .hand-type .name {
      font-weight: 500;
    }
    
    .hand-type .desc {
      font-size: 11px;
      color: var(--text-light);
    }
    
    .hand-type.active .desc {
      color: var(--gold);
    }
    
    /* ç‰¹æ®Šé€‰é¡¹ */
    .special-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .special-btn {
      padding: 8px 14px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      background: transparent;
      color: var(--text-light);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .special-btn.active {
      border-color: var(--accent);
      background: rgba(231, 76, 60, 0.15);
      color: var(--accent);
    }
    
    /* ç»“æœæ˜¾ç¤º */
    .result-card {
      background: linear-gradient(135deg, #1f3460 0%, #16213e 100%);
      border: 2px solid var(--primary);
      text-align: center;
      padding: 24px 20px;
      position: relative;
      overflow: hidden;
    }
    
    .result-card::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(201,162,39,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    
    .result-card .label {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 6px;
    }
    
    .result-card .score {
      font-size: 48px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 8px;
      color: var(--gold);
      text-shadow: 0 0 20px rgba(255,215,0,0.3);
    }
    
    .result-card .score-unit {
      font-size: 18px;
      color: var(--text-light);
    }
    
    .result-detail {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-top: 12px;
    }
    
    .result-detail span {
      background: rgba(255,255,255,0.08);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      color: var(--text-light);
    }
    
    .result-detail span.highlight {
      background: rgba(201,162,39,0.2);
      color: var(--gold);
    }
    
    /* åˆ†é¡¹æ˜ç»† */
    .score-breakdown {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: left;
    }
    
    .breakdown-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 4px 0;
      color: var(--text-light);
    }
    
    .breakdown-row span:last-child {
      color: var(--text);
      font-weight: 500;
    }
    
    /* åº•éƒ¨åˆ†äº«æ  */
    .action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      padding: 14px 20px;
      padding-bottom: calc(14px + env(safe-area-inset-bottom));
      box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
      display: flex;
      gap: 12px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-reset {
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    
    .btn-share {
      background: linear-gradient(135deg, var(--primary) 0%, #e6b800 100%);
      color: #1a1a2e;
    }
    
    .btn:active {
      transform: scale(0.97);
    }
    
    /* Toast */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: var(--card-light);
      color: var(--text);
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      transition: transform 0.3s;
      z-index: 1000;
      border: 1px solid var(--primary);
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†å™¨</h1>
    <p>ç²¾ç‰Œ Â· ç•ªæ•° Â· å†²å…³</p>
  </div>
  
  <div class="container">
    <!-- ç²¾ç‰Œç»Ÿè®¡ -->
    <div class="card">
      <div class="card-title">ç²¾ç‰Œç»“ç®—</div>
      <div class="jing-row">
        <span class="jing-label">æ­£ç²¾ ğŸ€„</span>
        <div class="jing-count">
          <button class="jing-btn" data-type="zheng" data-dir="-1">âˆ’</button>
          <span class="jing-num" id="zheng-num">0</span>
          <button class="jing-btn" data-type="zheng" data-dir="1">+</button>
          <span class="jing-sub" id="zheng-sub">Ã—2</span>
        </div>
      </div>
      <div class="jing-row">
        <span class="jing-label">å‰¯ç²¾ ğŸ€…</span>
        <div class="jing-count">
          <button class="jing-btn" data-type="fu" data-dir="-1">âˆ’</button>
          <span class="jing-num" id="fu-num">0</span>
          <button class="jing-btn" data-type="fu" data-dir="1">+</button>
          <span class="jing-sub">Ã—1</span>
        </div>
      </div>
      <div class="jing-row">
        <span class="jing-label">éœ¸ç‹ç²¾ ğŸ‘‘</span>
        <div class="jing-count">
          <span class="jing-num" id="bangjin-tag" style="color: var(--text-light);">æœªè®¡ç®—</span>
        </div>
      </div>
      <div class="jing-row">
        <span class="jing-label">å†²å…³å¥–åŠ± ğŸ¯</span>
        <div class="jing-count">
          <span class="jing-num" id="chongguan-tag" style="color: var(--gold);">æ— </span>
        </div>
      </div>
    </div>
    
    <!-- ç©å®¶èº«ä»½ -->
    <div class="card">
      <div class="card-title">ç©å®¶èº«ä»½</div>
      <div class="role-selector">
        <button class="role-btn active" data-role="zhuang">ğŸ”¸ åº„å®¶</button>
        <button class="role-btn" data-role="xian">ğŸ”¹ é—²å®¶</button>
        <button class="role-btn" data-role="pao">ğŸ’£ ç‚¹ç‚®</button>
      </div>
    </div>
    
    <!-- èƒ¡ç‰Œç±»å‹ -->
    <div class="card">
      <div class="card-title">èƒ¡ç‰Œç±»å‹</div>
      <div class="hand-types">
        <div class="hand-type" data-type="zimo" data-desc="è‡ªæ‘¸Ã—2">
          <span class="name">è‡ªæ‘¸</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type active" data-type="pihu" data-desc="åŸºç¡€1ç•ª">
          <span class="name">å¹³èƒ¡</span>
          <span class="desc">1ç•ª</span>
        </div>
        <div class="hand-type" data-type="pengpenghu" data-desc="ç¢°ç¢°èƒ¡Ã—2">
          <span class="name">å¤§ä¸ƒå¯¹</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="qidui" data-desc="ä¸ƒå¯¹Ã—2">
          <span class="name">å°ä¸ƒå¯¹</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="shisanlan" data-desc="åä¸‰çƒ‚Ã—2">
          <span class="name">åä¸‰çƒ‚</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="qixing" data-desc="ä¸ƒæ˜ŸÃ—4">
          <span class="name">ä¸ƒæ˜Ÿåä¸‰çƒ‚</span>
          <span class="desc">Ã—4</span>
        </div>
        <div class="hand-type" data-type="jingdiao" data-desc="ç²¾é’“Ã—2">
          <span class="name">ç²¾é’“</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="qianggang" data-desc="æŠ¢æ Ã—2">
          <span class="name">æŠ¢æ èƒ¡</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="gangshang" data-desc="æ å¼€Ã—2">
          <span class="name">æ ä¸Šå¼€èŠ±</span>
          <span class="desc">Ã—2</span>
        </div>
        <div class="hand-type" data-type="tianhu" data-desc="20å­">
          <span class="name">å¤©èƒ¡</span>
          <span class="desc">20å­</span>
        </div>
        <div class="hand-type" data-type="dihu" data-desc="20å­">
          <span class="name">åœ°èƒ¡</span>
          <span class="desc">20å­</span>
        </div>
      </div>
    </div>
    
    <!-- ç‰¹æ®Šé€‰é¡¹ -->
    <div class="card">
      <div class="card-title">ç‰¹æ®ŠçŠ¶æ€</div>
      <div class="special-options">
        <button class="special-btn" data-special="deguo">ğŸ‡©ğŸ‡ª å¾·å›½</button>
        <button class="special-btn" data-special="dezhongde">ğŸ‡©ğŸ‡ªğŸ‡©ğŸ‡ª å¾·ä¸­å¾·</button>
        <button class="special-btn" data-special="gang">ğŸšª æš—æ </button>
        <button class="special-btn" data-special="minggang">ğŸšª æ˜æ </button>
        <button class="special-btn" data-special="gangjin">ğŸ’£ æ ç²¾</button>
      </div>
    </div>
    
    <!-- è®¡ç®—ç»“æœ -->
    <div class="card result-card">
      <div class="label">èƒ¡ç‰Œå¾—åˆ†</div>
      <div class="score" id="result-score">2<span class="score-unit">å­</span></div>
      <div class="result-detail" id="result-detail"></div>
      
      <div class="score-breakdown">
        <div class="breakdown-row">
          <span>ç²¾ç‰Œåˆ†</span>
          <span id="breakdown-jing">0</span>
        </div>
        <div class="breakdown-row">
          <span>å†²å…³/éœ¸ç‹</span>
          <span id="breakdown-chongguan">0</span>
        </div>
        <div class="breakdown-row">
          <span>æ ç‰Œåˆ†</span>
          <span id="breakdown-gang">0</span>
        </div>
        <div class="breakdown-row">
          <span>èƒ¡ç‰Œç•ªæ•°</span>
          <span id="breakdown-fan">0</span>
        </div>
        <div class="breakdown-row" style="color: var(--gold);">
          <span>æ€»è®¡</span>
          <span id="breakdown-total">0</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- åº•éƒ¨æ“ä½œæ  -->
  <div class="action-bar">
    <button class="btn btn-reset" id="btn-reset">é‡ç½®</button>
    <button class="btn btn-share" id="btn-share">å¤åˆ¶æˆ˜ç»©</button>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
  
  <script>
    // çŠ¶æ€
    let state = {
      role: 'zhuang',
      zheng: 0,
      fu: 0,
      handTypes: new Set(['pihu']),
      specials: new Set()
    };
    
    // ç‰Œå‹å®šä¹‰
    const handTypeData = {
      pihu: { name: 'å¹³èƒ¡', fan: 1 },
      zimo: { name: 'è‡ªæ‘¸', fan: 2 },
      pengpenghu: { name: 'å¤§ä¸ƒå¯¹', fan: 2 },
      qidui: { name: 'å°ä¸ƒå¯¹', fan: 2 },
      shisanlan: { name: 'åä¸‰çƒ‚', fan: 2 },
      qixing: { name: 'ä¸ƒæ˜Ÿåä¸‰çƒ‚', fan: 4 },
      jingdiao: { name: 'ç²¾é’“', fan: 2 },
      qianggang: { name: 'æŠ¢æ èƒ¡', fan: 2 },
      gangshang: { name: 'æ ä¸Šå¼€èŠ±', fan: 2 },
      tianhu: { name: 'å¤©èƒ¡', base: 20 },
      dihu: { name: 'åœ°èƒ¡', base: 20 }
    };
    
    // DOM å…ƒç´ 
    const zhengNum = document.getElementById('zheng-num');
    const fuNum = document.getElementById('fu-num');
    const resultScore = document.getElementById('result-score');
    const resultDetail = document.getElementById('result-detail');
    const toast = document.getElementById('toast');
    
    // å†²å…³å€ç‡è¡¨
    const chongguanTable = {
      5: 2, 6: 3, 7: 4, 8: 5, 9: 6, 10: 7,
      11: 8, 12: 9, 13: 10, 14: 11
    };
    
    function calculate() {
      // 1. è®¡ç®—ç²¾ç‰Œåˆ†
      const jingScore = state.zheng * 2 + state.fu * 1;
      
      // 2. è®¡ç®—å†²å…³
      const totalJing = state.zheng + state.fu;
      let chongguanMulti = 1;
      let chongguanScore = 0;
      
      if (totalJing >= 5 && chongguanTable[totalJing]) {
        chongguanMulti = chongguanTable[totalJing];
        chongguanScore = jingScore * (chongguanMulti - 1);
      }
      
      // æ›´æ–°å†²å…³æ˜¾ç¤º
      const chongguanTag = document.getElementById('chongguan-tag');
      if (chongguanScore > 0) {
        chongguanTag.textContent = `Ã—${chongguanMulti} (+${chongguanScore})`;
      } else {
        chongguanTag.textContent = 'æ— ';
      }
      
      // éœ¸ç‹ç²¾ï¼ˆç®€åŒ–ï¼šå‡è®¾åªæœ‰ä½ æœ‰ç²¾ï¼‰
      let bangjinScore = 0;
      if (totalJing > 0) {
        // ç®€åŒ–åˆ¤æ–­ï¼šæ­£ç²¾>0ä¸”æ€»é¢=æ­£ç²¾æ•°æ—¶ä¸ºéœ¸ç‹
        if (state.zheng > 0 && totalJing === state.zheng) {
          bangjinScore = jingScore;
          document.getElementById('bangjin-tag').textContent = `âœ“ (+${bangjinScore})`;
          document.getElementById('bangjin-tag').style.color = 'var(--gold)';
        } else if (state.fu > 0 && totalJing === state.fu) {
          bangjinScore = jingScore;
          document.getElementById('bangjin-tag').textContent = `âœ“ (+${bangjinScore})`;
          document.getElementById('bangjin-tag').style.color = 'var(--gold)';
        } else {
          bangjinScore = 0;
          document.getElementById('bangjin-tag').textContent = 'æ— ';
          document.getElementById('bangjin-tag').style.color = 'var(--text-light)';
        }
      } else {
        document.getElementById('bangjin-tag').textContent = 'æ— ';
        document.getElementById('bangjin-tag').style.color = 'var(--text-light)';
      }
      
      const jingTotalScore = jingScore + chongguanScore + bangjinScore;
      
      // 3. æ ç‰Œåˆ†
      let gangScore = 0;
      if (state.specials.has('gang')) gangScore += 6; // æš—æ 3å®¶Ã—2
      if (state.specials.has('minggang')) gangScore += 3; // æ˜æ 3å®¶Ã—1
      if (state.specials.has('gangjin')) gangScore += 30; // æ ç²¾+10Ã—3å®¶
      
      // 4. èƒ¡ç‰Œåˆ†
      let baseScore = 1; // å¹³èƒ¡åŸºç¡€
      let fanMulti = 1;
      let huDetails = [];
      
      // å¤©èƒ¡åœ°èƒ¡å•ç‹¬è®¡ç®—
      if (state.handTypes.has('tianhu') || state.handTypes.has('dihu')) {
        baseScore = 20;
        fanMulti = 0; // ä¸å†ç¿»å€
        if (state.handTypes.has('tianhu')) huDetails.push('å¤©èƒ¡');
        if (state.handTypes.has('dihu')) huDetails.push('åœ°èƒ¡');
      } else {
        // æ™®é€šèƒ¡ç‰Œè®¡ç®—ç•ªæ•°
        state.handTypes.forEach(type => {
          if (handTypeData[type]) {
            if (type !== 'pihu') { // å¹³èƒ¡å·²åœ¨baseScore=1ä¸­
              huDetails.push(handTypeData[type].name);
            }
            // è®¡ç®—ç¿»å€
            if (handTypeData[type].fan) {
              fanMulti *= handTypeData[type].fan;
            }
          }
        });
      }
      
      // å¾·å›½ç‰¹æ®Šè®¡ç®—
      let deguoBonus = 0;
      if (state.specials.has('deguo')) {
        deguoBonus = 5;
        huDetails.push('å¾·å›½');
        if (state.handTypes.has('zimo')) {
          fanMulti *= 2;
        }
      }
      if (state.specials.has('dezhongde')) {
        deguoBonus = 5;
        fanMulti *= 4;
        huDetails.push('å¾·ä¸­å¾·');
      }
      
      const huScore = baseScore * fanMulti + deguoBonus;
      
      // 5. åº„å®¶/ç‚¹ç‚®ç¿»å€
      let roleMulti = 1;
      if (state.role === 'zhuang') {
        roleMulti = 2;
        if (!state.handTypes.has('tianhu') && !state.handTypes.has('dihu')) {
          huDetails.push('åº„å®¶');
        }
      } else if (state.role === 'pao') {
        roleMulti = 2;
        if (!state.handTypes.has('dihu')) {
          huDetails.push('ç‚¹ç‚®');
        }
      }
      
      // åº„å®¶ç²¾ç‰Œä¸ç¿»å€ï¼Œåªç®—èƒ¡ç‰Œåˆ†ç¿»å€
      const finalScore = (jingTotalScore + gangScore + huScore) * roleMulti;
      
      // æ›´æ–°UI
      resultScore.innerHTML = `${finalScore}<span class="score-unit">å­</span>`;
      
      // è¯¦æƒ…
      resultDetail.innerHTML = huDetails.map(d => `<span class="highlight">${d}</span>`).join('');
      
      // åˆ†é¡¹æ˜ç»†
      document.getElementById('breakdown-jing').textContent = jingScore;
      document.getElementById('breakdown-chongguan').textContent = chongguanScore + bangjinScore;
      document.getElementById('breakdown-gang').textContent = gangScore;
      document.getElementById('breakdown-fan').textContent = huScore;
      document.getElementById('breakdown-total').textContent = finalScore;
    }
    
    // ç²¾ç‰ŒæŒ‰é’®
    document.querySelectorAll('.jing-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.type;
        const dir = parseInt(btn.dataset.dir);
        
        if (type === 'zheng') {
          state.zheng = Math.max(0, Math.min(4, state.zheng + dir));
          zhengNum.textContent = state.zheng;
        } else {
          state.fu = Math.max(0, Math.min(4, state.fu + dir));
          fuNum.textContent = state.fu;
        }
        calculate();
      });
    });
    
    // è§’è‰²é€‰æ‹©
    document.querySelectorAll('.role-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.role = btn.dataset.role;
        calculate();
      });
    });
    
    // ç‰Œå‹é€‰æ‹©
    document.querySelectorAll('.hand-type').forEach(el => {
      el.addEventListener('click', () => {
        const type = el.dataset.type;
        
        // å¹³èƒ¡ä¸èƒ½å–æ¶ˆ
        if (type === 'pihu') return;
        
        if (state.handTypes.has(type)) {
          state.handTypes.delete(type);
          el.classList.remove('active');
        } else {
          state.handTypes.add(type);
          el.classList.add('active');
        }
        calculate();
      });
    });
    
    // ç‰¹æ®Šé€‰é¡¹
    document.querySelectorAll('.special-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const special = btn.dataset.special;
        
        if (state.specials.has(special)) {
          state.specials.delete(special);
          btn.classList.remove('active');
        } else {
          state.specials.add(special);
          btn.classList.add('active');
        }
        calculate();
      });
    });
    
    // é‡ç½®
    document.getElementById('btn-reset').addEventListener('click', () => {
      state = {
        role: 'zhuang',
        zheng: 0,
        fu: 0,
        handTypes: new Set(['pihu']),
        specials: new Set()
      };
      
      zhengNum.textContent = 0;
      fuNum.textContent = 0;
      
      document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.role-btn[data-role="zhuang"]').classList.add('active');
      
      document.querySelectorAll('.hand-type').forEach(el => {
        el.classList.toggle('active', el.dataset.type === 'pihu');
      });
      
      document.querySelectorAll('.special-btn').forEach(el => el.classList.remove('active'));
      
      calculate();
    });
    
    // å¤åˆ¶æˆ˜ç»©
    document.getElementById('btn-share').addEventListener('click', async () => {
      const score = document.getElementById('result-score').textContent;
      const jing = document.getElementById('breakdown-jing').textContent;
      const gang = document.getElementById('breakdown-gang').textContent;
      const hu = document.getElementById('breakdown-fan').textContent;
      const detail = Array.from(document.querySelectorAll('#result-detail span')).map(s => s.textContent).join ' ';
      
      const text = `ğŸ€„ å—æ˜Œéº»å°†è®°åˆ†
å¾—åˆ†ï¼š${score}
â”œ ç²¾ç‰Œåˆ†ï¼š${jing}
â”œ æ ç‰Œåˆ†ï¼š${gang}
â”” èƒ¡ç‰Œåˆ†ï¼š${hu}
${detail}`;
      
      try {
        await navigator.clipboard.writeText(text);
        showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch (err) {
        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    });
    
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }
    
    // åˆå§‹åŒ–
    calculate();
  </script>
</body>
</html>
